#include "../include/war.h"
static void rc4_init(unsigned char *S, const unsigned char *key, size_t keylen) { int i, j = 0; unsigned char tmp; for (i = 0; i < 256; i++) S[i] = i; for (i = 0; i < 256; i++) { j = (j + S[i] + key[i % keylen]) % 256; tmp = S[i]; S[i] = S[j]; S[j] = tmp; } } void rc4_crypt(unsigned char *data, size_t datalen, const unsigned char *key, size_t keylen) { unsigned char S[256]; unsigned char tmp; int i = 0, j = 0; size_t k; rc4_init(S, key, keylen); for (k = 0; k < datalen; k++) { i = (i + 1) % 256; j = (j + S[i]) % 256; tmp = S[i]; S[i] = S[j]; S[j] = tmp; data[k] ^= S[(S[i] + S[j]) % 256]; } } 